Мова: [English](../en/server.md) | **Українська**

# SA:MP Mobile CEF

## Важлива інформація
- Якщо довжина інформації, яку ви передаєте в/з коллбеку, більша, ніж зазначено в `SAMPMobileCef.inc` (за замовчуванням, 2048), є можливість розширити її вручну:
> [!NOTE]
> Клієнтська частина використовує динамічне виділення пам'яті, тому **обмеження по довжині присутні тільки в серверній частині**. Для зручності розробників додана можливість вручного розширення довжини даних у серверній частині.
```pawn
/* Використовувати цей спосіб слід перед підключенням заголовкового файлу SAMPMobileCef.inc */
#define CEF_MAX_EVENT_NAME_LENGTH 64 // розширити максимальну довжину імені коллбеку (за замовчуванням, 48)
#define CEF_MAX_EVENT_CALLBACK_LENGTH 72 // розширити максимальну довжину імені функції-коллбеку (за замовчуванням, 64)
#define CEF_MAX_EVENT_DATA_LENGTH 4096 // розширити максимальну довжину даних коллбеку (за замовчуванням, 2048)
```
- Дуже не рекомендується використовувати всю виділену під дані коллбеку пам'ять (2048 символів). Завжди залишайте вільний простір при передачі даних у коллбек (з обох сторін). У разі, якщо це неможливо, розширте пам'ять способом вище.

## Встановлення та налаштування серверної частини
- Експортуйте файл `server/SAMPMobileCef.inc` до директорії `pawno/include` (Windows)
- Встановіть наступні залежності: [`Pawn.RakNet`](https://github.com/katursis/Pawn.RakNet), [`pawn-json`](https://github.com/Southclaws/pawn-json) та [`SA-MP GVar Plugin`](https://github.com/samp-incognito/samp-gvar-plugin)
- Підключіть раніше встановлені плагіни та заголовковий файл `SAMPMobileCef.inc` в ігровому моді:
    ```pawn
    #include <Pawn.RakNet>
    #include <json>
    #include <gvar>
    #include <SAMPMobileCef>
    ```
- Для зручності оголосіть макрос `CEF_PACKET_ID` з ідентифікатором мережевого пакету:
    ```pawn
    #define CEF_PACKET_ID 252 // або будь-який інший, який ви вказали під час налаштування клієнтської частини
    ```
- У публічній функції `OnGameModeInit` викличте функцію `OnGameModeInit`:
    ```pawn
    public OnGameModeInit()
    {
        CefSetPacketId(CEF_PACKET_ID); // раніше оголошений макрос з ідентифікатором мережевого пакету
    	
        return 1;
    }
    ```
- Детальний спосіб роботи з функціоналом, упаковки та читання даних можете знайти у [**простому прикладі**](../../example/server/example.pwn). У разі виникнення труднощів у реалізації вашої задумки - [**пишіть сюди**](https://github.com/denis-akazuki/samp-mobile-cef/issues).

## Список функцій
### `CefSetPacketId(packet_id)`
Встановлює ID мережевого пакету для взаємодії з CEF.

- **Параметри**:
  - `packet_id` (int): ID пакету, який буде використовуватись для CEF.

### `CefInitBrowser(playerid, url[])`
Ініціалізує браузер для вказаного гравця.

> [!NOTE]
> Не слід пересоздавати браузер при кожному його використанні. Ініціалізуйте його при підключенні гравця один раз і використовуйте в подальшому.

- **Параметри**:
  - `playerid` (int): ID гравця.
  - `url` (string): URL, який буде завантажено в браузері.

### `CefDestroyBrowser(playerid)`
Знищує браузер для вказаного гравця.

- **Параметри**:
  - `playerid` (int): ID гравця.

### `CefShowBrowser(playerid)`
Показує браузер вказаному гравцеві.

- **Параметри**:
  - `playerid` (int): ID гравця.

### `CefHideBrowser(playerid)`
Приховує браузер для вказаного гравця.

- **Параметри**:
  - `playerid` (int): ID гравця.

### `CefSetBrowserUrl(playerid, url[])`
Встановлює URL браузера для вказаного гравця.

- **Параметри**:
  - `playerid` (int): ID гравця.
  - `url` (string): URL, який буде завантажено в браузері.

### `CefChangeBrowserFocus(playerid, is_focused)`
Змінює стан фокусу (клікабельності) браузера для вказаного гравця. За замовчуванням, браузер ініціалізується з увімкненим фокусом (клікабельністю).

- **Параметри**:
  - `playerid` (int): ID гравця.
  - `is_focused` (bool): Значення `true`, якщо браузер повинен бути у фокусі (клікабельним), і `false` в іншому випадку.

### `CefSendEvent(playerid, event_name[], event_data[])`
Відправляє подію до браузера вказаного гравця.

- **Параметри**:
  - `playerid` (int): ID гравця.
  - `event_name` (string): Назва події.
  - `event_data` (string): Упаковані дані JSON.

### `CefRegisterEventCallback(event_name[], callback[])`
Реєструє функцію зворотного виклику (коллбек) для вказаної події.

- **Параметри**:
  - `event_name` (string): Назва події.
  - `callback` (string): Ім'я функції зворотного виклику (коллбек), яка буде виконана при отриманні події від клієнта.

### `CefIsPlayerHasLibrary(playerid)`
Перевіряє, чи присутня у вказаного гравця бібліотека CEF.

> [!WARNING]
> Не слід використовувати цю функцію у публічній функції `OnPlayerConnect`. Клієнт може не встигнути відправити інформацію про гравця під час його підключення.

- **Параметри**:
  - `playerid` (int): ID гравця.
- **Повертає**: `true`, якщо бібліотека CEF присутня, `false` в іншому випадку.

## Список коллбеків
### `OnCefBrowserInit(playerid, is_init, error_code)`
Викликається після завантаження вказаного при ініціалізації (або ручній зміні) URL.

- **Параметри**:
  - `playerid` (int): ID гравця.
  - `is_init` (bool): `true`, якщо URL був успішно завантажений, `false` в іншому випадку.
  - `error_code` (int): `-1` при успішному завантаженні URL, `0` у випадку невідомої помилки або `HTTP статус код`.

---
**Copyright © 2024 [Denis Akazuki](https://github.com/denis-akazuki).**
